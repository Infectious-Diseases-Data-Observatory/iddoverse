---
title: "iddoverse" output: rmarkdown::html_vignette vignette: >
%\VignetteIndexEntry{iddoverse} %\VignetteEncoding{UTF-8}
%\VignetteEngine{knitr::rmarkdown} editor_options: markdown: wrap: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  error = TRUE # ,
  # eval = can_decrypt
)
```

## Purpose

Creating analysis ready datasets ('analysis datasets') in R, using the data from the Infectious Diseases Data Observatory (IDDO) repository. 

Data requesters can use this package to support the transformation of datasets (known as domains) from SDTM (Study Data Tabulation Model, the data format used by IDDO) to datasets for analysis ('analysis datasets'). The package is intended for epidemiologists, statisticians and data scientists with a diverse range of programming ability, but with some familiarity with R software. Advanced knowledge of the SDTM ontology is not required. This package intends to minimise the time spent on data manipulation, whilst also ensuring reproducibility and increases the accessibility of the SDTM format. All functions come with documentation and examples which can be viewed using the `?` command.

## Installing the Package

```{r, warning=FALSE, message=FALSE}
# uncomment the following line to install these packages if required
# install.packages(c("devtools"))
devtools::install_github("RhysPeploe/iddoverse")

library(iddoverse)
```

## Getting Started

IDDO uses the Study Data Tabulation Model (SDTM) format for most of its data, so when the data is transferred to data requesters, there will be several datasets, each with a specific purpose. These datasets are referred to as domains and each have a two letter code (i.e. DM - demographics, MB - microbiology, VS - vital signs).

Within the package, there are several synthetic, example domains that can be used to gain familiarity with the IDDO-SDTM data. Each domain starts with the two letter domain code followed by the studyid: RPTESTB

```{r}
# demographics (DM) domain
DM_RPTESTB

# microbiology (MB) domain
MB_RPTESTB
```

## `prepare_domain()`

SDTM domains, such as the MB domain, can have up to 3 columns for the results and a variety of over 20 timing variables, while this preserves the intricacies in the trial data, it also creates complexity for analysis. `prepare_domain()` takes a single IDDO-SDTM domain, amalgamates the data so that there is one 'best choice' result and timing variable, then pivots the rows by the best choice time variable (`TIME`, `TIME_SOURCE`), the study id (`STUDYID`) and participant number (`USUBJID`). The different events/findings/tests then become columns and the dataset is populated with the associated result, providing a condensed dataset which is more digestible can be easily merged with other data. Each dataset (known as a domain) hastwo letter domain code is specified in the first parameter, followed by the domain data frame.

```{r}
prepare_domain("mb",
               MB_RPTESTB)
```

timing vars/heirarchy
```{r}
prepare_domain("MB",
               MB_RPTESTB,
               timing_variables = "VISITDY")
```

vars include
```{r}
prepare_domain("vs", 
               VS_RPTESTB, 
               variables_include = "TEMP")
```

loc and method
```{r}
prepare_domain("vs", 
               VS_RPTESTB, 
               variables_include = "TEMP", 
               include_LOC = TRUE)
```

values fn
join two prepares 

```{r}

```


## Standardised Tables for Analysis

```{r}
create_participant_table(dm_domain = DM_RPTESTB,
                         rp_domain = RP_RPTESTB,
                         vs_domain = VS_RPTESTB)
```

```{r}
create_malaria_pcr_table(pf_domain = PF_RPTESTB,
                         rs_domain = RS_RPTESTB)
```

## Data Checks \& Summaries

```{r}
check_data(DM_RPTESTB)

check_data(LB_RPTESTB)
```


## Other resources

paper
iddo wiki
data team videos
